---
import Base from "../layouts/Base.astro";
import { getCollection } from "astro:content";
import ProjectLinks from "../components/ProjectLinks.astro";

// Parse "YYYY-MM" or any Date-compatible string; undefined -> 0
const toTime = (s?: string) => {
  if (!s) return 0;
  const iso = /^\d{4}-\d{2}$/.test(s) ? `${s}-01` : s;
  const t = new Date(iso).getTime();
  return Number.isNaN(t) ? 0 : t;
};

const projects = (await getCollection("projects"))
  .slice()
  .sort((a, b) =>
    (Number(b.data.featured) - Number(a.data.featured)) || // featured first
    (toTime(b.data.date) - toTime(a.data.date)) ||         // newest -> oldest
    a.slug.localeCompare(b.slug)
  );
---
<Base title="Projects â€” Simon Bouchard">
  <h1 class="text-2xl font-bold mb-6">Projects</h1>
  <div class="grid gap-6 md:grid-cols-2">
    {projects.map((p) => (
      <article
        class={`rounded-2xl p-5 hover:shadow-sm transition ${
          p.data.featured
            ? "border-amber-400 bg-amber-50/40 ring-1 ring-amber-300"
            : "border"
        }`}
      >
        <a href={`/projects/${p.slug}/`} class="block">
          <h2 class="text-lg font-semibold flex items-center gap-2">
            <img
              src={`/projects/${p.slug}/icon.png`}
              alt=""
              class="size-5 rounded"
            />
            {p.data.title}
            {p.data.featured && (
              <span class="text-[10px] font-medium rounded-md px-1.5 py-0.5 bg-amber-400 text-slate-900 shadow-sm">
                Featured
              </span>
            )}
          </h2>
          <p class="mt-2 text-sm opacity-90">{p.data.description}</p>
        </a>
        <div class="mt-3 flex flex-wrap gap-2">
          {p.data.stack.slice(0, 5).map((s) => (
            <span class="text-xs px-2 py-1 rounded-full border opacity-80">
              {s}
            </span>
          ))}
        </div>
        <div class="mt-4">
          <ProjectLinks demo={p.data.demo} repo={p.data.repo} size="sm" />
        </div>
      </article>
    ))}
  </div>
</Base>
